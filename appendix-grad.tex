%!TEX root =  bgo.tex
% please do not delete or change the first line (needed by Csaba's editor)
\subsubsection*{Proof of Proposition \ref{prop:grad-spsa} for $f \in \C^3$}
\begin{proof}
We use the proof technique of \cite{spall1992multivariate} (in particular, Lemma 1 there) in order to prove the main claim here.
  
Since $\xi_n^+, \xi_n^-$ are zero mean by assumption, we have
\begin{align*}
&\E\left[  V\left(\dfrac{\xi_n^+ - \xi_n^-}{2\delta}\right) \right]= 0 \quad \Rightarrow \quad
\E[G] =  \E\left[ V \left(\dfrac{f(x+\delta U)  - f(x-\delta U) }{2\delta}\right)\right],
\end{align*}

By Taylor's series expansions, we obtain, a.s.,
\begin{align*}
f(x \pm \delta U) = f(x) \pm \delta U\tr \nabla f(x) + \frac{\delta^2}{2} U\tr \nabla^2 f(x) U \pm  \frac{\delta^3}{6} \nabla^3 f(\tilde x^{\pm})(U \otimes U \otimes U),
\end{align*}
where $\otimes$ denotes the Kronecker product and $\tilde x^+$ (resp. $\tilde x^-)$ is on the line segment between $x$ and $(x + \delta U)$ (resp. $(x - \delta U)$).
Hence,
\begin{align}
&\E\left[V\left(\dfrac{f(x+\delta U) - f(x-\delta U)}{2\delta}\right) \right] \nonumber\\
= &\E\left[V U\tr \left.\nabla f(x)\right| \F_n\right]  +   \E\left[\frac{\delta^2}{12} V (\nabla^3 f(\tilde  x^+)+\nabla^3 f(\tilde  x^-))(U \otimes U \otimes U)\right]. \label{eq:l1}\\
\le & \nabla f(x) +  C_1 \delta^2.\label{eq:l2} \text{ for some } C_1>0.
\end{align}
The last inequality follows from the facts that $E[V U\tr] = I$, and that $\EE{\norm{V}}$ and $\EE{\norm{U \otimes U \otimes U}}$ have finite upper bounds.

Bound on the variance of $G$:
Using the inequality $\E\left\|X -  E[X]\right\|^2 \le 4 \E \left\|X\right\|^2$ for any random variable $X$, we bound $\E\left\| G - \E G\right\|^2$ as follows:
\begin{align}
&\E\left\| G - \E G\right\|^2 \nonumber\\
\le& 4 \E \left\|G\right\|^2 \label{eq:mi}\\
= & 4\E\left( \left\| V \right\|^2 \left(\left(\dfrac{\xi^+ - \xi^-}{2\delta}\right)^2  + 2 \left(\dfrac{\xi^+ - \xi^-}{2\delta}\right) \left(\dfrac{f(x+\delta U) - f(x-\delta U)}{2\delta}\right) 
+ \left( \dfrac{f(x+\delta U) - f(x-\delta U)}{2\delta} \right)^2 \right)\right)\nonumber \\
= & 4\E\left( \left\| V \right\|^2 \left(\dfrac{\xi^+ - \xi^-}{2\delta}\right)^2\right)   
+ 4 \E \left(\left\| V \right\|^2 \right)\left( \dfrac{f(x+\delta U) - f(x-\delta U)}{2\delta} \right)^2  \label{eq:h3} \\
\le & \frac{C_2}{\delta^2}, \text{ for some } C_2< \infty. \label{eq:h4}
\end{align}
The inequality in \eqref{eq:h3} follows from $\E\left( \xi^+ \mid V \right) = \E\left( \xi^- \mid V \right) = 0$, while that in \eqref{eq:h4} follows from the facts that  the span of the function $f$ is bounded and $\E\norm{V}$ is finite. 
\end{proof}


\subsubsection*{Proof of Proposition \ref{prop:grad-spsa} for convex and smooth $f$}
\begin{proof}
Since $f$ is convex with a  $L$-Lipschitz gradient, we have the following for any $\delta>0$:
\begin{align*}
\frac{\<\nabla f(x), \delta u\>}{\delta} \le \frac{f(x + \delta u) -  f(x)}{\delta} \le& \frac{\<\nabla f(x), \delta u\> + (L / 2) \norm{\delta u}^2}{\delta}
% \frac{f(x - \delta u) -  f(x)}{\delta} \le& -\frac{\<\nabla f(x), \delta u\> + (L / 2) \norm{\delta u}^2}{\delta}
\end{align*}
Hence,
\begin{align*}
\left|\frac{f(x + \delta u) -  f(x)}{\delta} - \<\nabla f(x),  u\> \right| \le&  \dfrac{L}{2} \norm{u}^2
% \frac{f(x - \delta u) -  f(x)}{\delta} \le& -\frac{\<\nabla f(x), \delta u\> + (L / 2) \norm{\delta u}^2}{\delta}
\end{align*}

\end{proof}


\subsubsection*{One-point feedback}
\begin{proposition}
\label{prop:grad-1spsa}
Given any $f$ that is three times continuously differentiable with bounded third derivative. 
For any $x \in \cK$, and $\delta >0$, let oracle $\gamma$ return 
\begin{align}
% Y = x+\delta U \,, \quad
G =  V \left(\dfrac{f(x+\delta U) + \xi}{\delta}\right),
 \label{eq:onesp}
\end{align}
where $V, U$ are random variables that satisfy $\E[V U\tr] = I_d$, $U_i, i=1,\ldots,d$ are i.i.d., $\E[ V U^2] = 0$, $\E[V_i]=0$, $|U_i|$ and $\E|V_i|$ have finite upper bounds. 
Then, we have that $\gamma$ is a type-I oracle with $c_1(\delta) = C_1 \delta^2$ and $c_2(\delta) = C_2/\delta^2$.
\end{proposition}
\begin{proof}
As in the case of two-point feedback, we can ignore the noise element in $G$, i.e.,
\begin{align*}
&\E\left[  V\dfrac{\xi}{\delta} \right]= 0 \quad \Rightarrow \quad
\E[G] =  \E\left[ V \left(\dfrac{f(x+\delta U) }{\delta}\right)\right],
\end{align*}

% By Taylor's series expansions, we obtain, a.s.,
% \begin{align*}
% f(x + \delta U) = f(x) \pm \delta U\tr \nabla f(x) + \frac{\delta^2}{2} U\tr \nabla^2 f(x) U +  \frac{\delta^3}{6} \nabla^3 f(\tilde x^{+})(U \otimes U \otimes U),
% \end{align*}
% where $\otimes$ and $\tilde x^+$ are as in the proof of Proposition \ref{prop:grad-spsa}.
Using suitable Taylor's series expansions, we have %the following for any $i=1,\ldots,d$:
\begin{align}
&\E\left[V\left(\dfrac{f(x+\delta U)}{\delta}\right) \right] \nonumber\\
= & \E\left[V \dfrac{f(x)}{\delta} \right] + \E\left[V U\tr \left.\nabla f(x)\right| \F_n\right]  +   \E\left[\frac{\delta}{2}  \nabla^2 f(\tilde  x^+)(V \otimes U \otimes U)\right] + \O\left( \delta^2\right). \label{eq:l1}\\
\le & \nabla f(x) + \O\left( \delta^2\right).\label{eq:l2}
\end{align}
The last inequality follows from the facts that $E[V U\tr] = I$, and for any $i=1,\ldots,d$, $E[V_i U_j^2] = 0$, $|U_i|$ and $\E|V_i|$ have finite upper bounds.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



% 
% \paragraph{One-point SPSA:}
% 
%  Since $f$ is $3$-times continuously differentiable, using Taylor's expansion, we get for the the $i^{th}$ component of $G$,
% \begin{align*}
% &\EE{G_{\cdot i}}\\
% =&\EE{\dfrac{1}{\delta \Delta_{\cdot i}} \left( f(x+\delta \Delta)+\epsilon \right) }\\
% =& \EE{\dfrac{1}{\delta \Delta_{\cdot i}} \left( f(x)+\delta f'(x)^\top \Delta+\dfrac{1}{2}\delta^2 \Delta^\top f''(x)\Delta \right) } \numberthis \label{eq:spsaTaylorExp} \\
% &+\EE{\dfrac{1}{\delta \Delta_{\cdot i}} \left(O(\delta^3 \Delta\otimes\Delta\otimes\Delta) +\epsilon \right) }\\
% =& [f'(x)]_i +O(\delta^2) \,,
% \end{align*}
% where $[f'(x)]_i$ denotes the $i^{th}$ component of $f'(x)$. The last equality comes from the properties of symmetry, and bounded moment for $\Delta$.
% Hence, $G$ is a estimate of $f'(x)$ with bias $O(\delta^2)$.
% 
% \paragraph{Two-point SPSA:}
% 
% Under this situation, using Taylor expansion again, the $f(x)$ and $f''(x)$ terms in \eqref{eq:spsaTaylorExp} can be canceled and one can conclude that $G$ is only an order $O(\delta^2)$ term away from $f'(x)$. Note that the second-order term in one-point SPSA is zero-mean, while in the two-point SPSA it is zero. 
% As a result, we only need $\Delta_{\cdot i}$ to be zero-mean instead of symmetry.
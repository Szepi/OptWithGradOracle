\documentclass[11pt,letterpaper,english]{article}

\input{commands}


\begin{document}
Given a vector space $\mathcal{X} \subset \R^d$, $\mu$ is a measure on it, $f: \R^d \to \R$ is a measurable function. The convolution of 
$f$ and $\mu$ at $x\in \mathcal{X}$ is defined as
\begin{align*}
\left( f*\mu \right) (x) := \int f(x-y)\mu (d y)
= \int f(y)\mu(x-dy) = \int f(y)\mu_x(dy)\,,
\end{align*}
where $\mu_x(A) = \mu(x-A)$ for any $A\in Borel(\mathcal{X})$. $Borel(\mathcal{X})$ is the Borel $\sigma$-field of $\mathcal{X}$.

Now we can see $\left\lbrace \mu_x: x\in \mathcal{X} \right\rbrace$ is a family of measures with the parameter $x$. The weak differentiability of $\mu_x$ can be defined as follows.
\begin{definition}
Fix $x_0 \in \mathcal{X}$, we say $\mu_x$ is weakly differentiable at $x_0$, if there exists a finite measure $\mu'_{x_0}: \mathcal{X}\to \mathcal{X}^*$ such that
\begin{align*}
\forall f \in \mathcal{C}_B(\mathcal{X}), \quad
\int f(y)\mu_{x_0+\xi}(dy) - \int f(y)\mu_{x_0}(dy)
-\ip{\int f(y)\mu'_{x_0}(dy), \xi} = \sigma(\norm{\xi}) \,,
\end{align*}
which goes to $0$ as $\norm{\xi} \to 0$. Note that $\norm{\mu'_{x_0}(A)}_*< \infty$ for any $A\in Borel(\mathcal{X})$, $\mathcal{C}_B(\mathcal{X})$ denotes the continuous, bounded, real-valued functions defined on $\mathcal{X}$.
\end{definition}
Consequently, we call $\mu'_x$ the weak derivative of $\mu_x$. And $\mu'_x$ is unique.

\begin{proposition}
\label{prop:diffconvolution}
For any $f \in \mathcal{C}_B(\mathcal{X})$, the differentiability of $f*\mu$ is equivalent to the differentiability of $\mu$ in the weak sense.
Moreover, $\forall x_0\in \mathcal{X}$, 
$\dfrac{d}{dx} (f*\mu) (x_0) = \int f(y)\mu'_{x_0}(dy)$.
\end{proposition}
\begin{proof}
Denote $\hat{f}(x) := (f*\mu)(x)$. Given any $x_0\in \mathcal{X}$, if $\hat{f}$ is differentiable at $x_0$, by the definition of differentiability, there exists $g \in \mathcal{X}^*$ such that
\begin{align}
\label{eq:diffhatf}
\hat{f}(x_0+\xi) - \hat{f}(x_0) 
= \int f(y)\mu_{x_0+\xi}(dy) - \int f(y)\mu_{x_0}(dy)
= \ip{g, \xi}+\sigma(\norm{\xi}) \,.
\end{align}
Choose some $\mathcal{X}^*$-valued measure $\lambda$ such that 
$g = \int f(y)\lambda(dy)$, then plug this into \eqref{eq:diffhatf}. Recall the definition of weak differentiability, combined with arbitrary $f$, we can see that $\lambda$ is the weak derivative of $\mu$. Hence, the differentiability of $(f*\mu)$ is a sufficient condition of the differentiability of $\mu$. 

Next, to prove its necessity, let $g=\int f(y)\mu'_{x_0}(dy)$. It is obvious that \eqref{eq:diffhatf} will also hold. Therefore, $(f*\mu)$ is differentiable. Its gradient $g$ at $x_0$ is $\int f(y)\mu'_{x_0}(dy)$.

Now we want to give a probability based representation of $\dfrac{d}{dx} (f*\mu) (x_0)$.

By \cref{prop:diffconvolution}, we have for any $x\in \mathcal{X}$,
\begin{align*}
\dfrac{d}{dx} (f*\mu) (x) = \int f(y)\mu'_{x}(dy)
= \int f(x-y)\mu'(dy) \,,
\end{align*}
where the second equality results from the definition $\mu'_{x}(A)=\mu'(x-A)$. Since $\mu':\mathcal{X}\to \mathcal{X}^*$ is a finite measure, we can define 
\begin{align*}
\forall A \in Borel(\mathcal{X}), \quad
\nu(A) = \dfrac{\norm{\mu'(A)}_*}{\norm{\mu'(\mathcal{X})}_*}\,,
\end{align*}
which is a probability measure. Hence 
$\dfrac{d}{dx} (f*\mu) (x) = \norm{\mu'(\mathcal{X})}_* \int f(x-y) \dfrac{d\mu'}{d\nu}(y) \nu(dy)$, where $\dfrac{d\mu'}{d\nu}$ is the Radon-Nikodym derivative of $\mu'$ w.r.t $\nu$.

Further assume $\mu$ is a probability measure with the distribution function $p(\cdot)$, i.e., $\mu(dx) = p(x)dx$. If $p(x)$ is differentiable, then
$\nu(dy) = \dfrac{\norm{p'(y)}_*}{\int \norm{p'(x)}_*dx}dy$.
So we have
\begin{align*}
\dfrac{d}{dx} (f*\mu) (x) = U \int f(x-y) q(y) \nu (dy)\,,
\end{align*}
where $U = \int \norm{p'(x)}_*dx$, $q(y) = \dfrac{p'(y)}{\norm{p'(y)}_*}$.



\end{proof}
\end{document}
